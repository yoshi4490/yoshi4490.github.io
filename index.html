<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>çµŒç†1ã‹æœˆã‚¹ãƒˆãƒ¼ãƒªãƒ¼å­¦ç¿’ v3ï¼ˆæ¼”å‡ºå¼·åŒ–ãƒ»10æ—¥ï¼‰</title>
<style>
  :root{--bg:#f6fbff;--ink:#0f172a;--muted:#64748b;--panel:#ffffff;--border:#e2e8f0;--brand:#3bb3df;--brand2:#12b4a6;--ok:#10b981;--ng:#ef4444;--shadow:0 10px 30px rgba(17,24,39,.08);--radius:18px;--gold:#f7b500;--silver:#bfc5d1;--bronze:#c08457;}
  *{box-sizing:border-box}html,body{height:100%}body{margin:0;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,'Noto Sans JP','Hiragino Kaku Gothic ProN','Yu Gothic',Meiryo,sans-serif;background:linear-gradient(180deg,#f6fbff 0%,#f9feff 100%);color:var(--ink)}
  header{position:sticky;top:0;z-index:10;background:linear-gradient(180deg,#fff,rgba(255,255,255,.85));backdrop-filter:blur(6px);border-bottom:1px solid var(--border)}
  .wrap{max-width:1100px;margin:0 auto;padding:14px 18px}.brand{display:flex;align-items:center;gap:10px;font-weight:800}.logo{width:28px;height:28px;border-radius:8px;background:linear-gradient(135deg,var(--brand),#a3dbf0);box-shadow:var(--shadow)}
  .progress{height:10px;background:#e5f3ff;border-radius:999px;overflow:hidden}.bar{height:100%;width:0%;background:linear-gradient(90deg,var(--brand2),#3bb3df);transition:width .3s ease}
  .pill{display:inline-block;font-size:12px;padding:2px 10px;border-radius:999px;background:#e6f7f5;color:#0a5e57;border:1px solid #d9f2ef}.btn{padding:10px 14px;border-radius:12px;border:1px solid var(--border);background:#fff;cursor:pointer;font-size:14px}
  .btn.primary{background:var(--brand2);color:#fff;border:none}.muted{color:var(--muted)}.card{background:var(--panel);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow)}
  .card .head{padding:14px 16px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center}.card .body{padding:16px}
  .grid{display:grid;gap:12px}.two{grid-template-columns:1fr 1fr}.scene{display:grid;grid-template-columns:1.2fr 1fr;gap:16px;align-items:center}.scene svg{width:100%;height:auto}
  label{display:block;font-size:12px;color:#334155;margin-bottom:6px}input,select{width:100%;padding:10px 12px;border:1px solid var(--border);border-radius:12px;font-size:14px;background:#fff}
  .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}.ok{color:var(--ok);font-weight:600}.ng{color:var(--ng);font-weight:600}.mono{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,'Courier New',monospace}
  .toast{position:fixed;right:16px;bottom:16px;background:#0f172a;color:#fff;padding:12px 14px;border-radius:12px;box-shadow:var(--shadow);opacity:.95;display:none;z-index:50}
  .top{display:grid;grid-template-columns:1.1fr 1fr;gap:16px;margin-top:16px}.center{text-align:center}.navdays{display:flex;gap:8px;flex-wrap:wrap}
  .footer{color:#9aa3af;font-size:12px;text-align:center;margin:16px 0}
  .modal{position:fixed;inset:0;background:rgba(15,23,42,.35);display:none;align-items:center;justify-content:center;z-index:40}
  .modal .box{background:#fff;border-radius:20px;padding:22px;width:min(560px,92vw);box-shadow:var(--shadow);text-align:center;transform:scale(.9);opacity:.6;animation:pop .35s forwards}
  @keyframes pop{to{transform:scale(1);opacity:1}}.medal{width:140px;height:140px;margin:0 auto 10px;border-radius:50%;position:relative;transform:scale(.8) rotate(-10deg);animation:medalIn .5s .15s forwards}
  @keyframes medalIn{to{transform:scale(1) rotate(0deg)}}.medal::after{content:'';position:absolute;inset:16px;border-radius:50%;background:#fff}.badge{position:absolute;left:50%;transform:translateX(-50%);top:-12px;background:#12b4a6;color:#fff;padding:4px 10px;border-radius:999px;font-weight:700;font-size:12px}
  #confetti{position:fixed;inset:0;pointer-events:none;z-index:45}.diagram{background:#f8feff;border:1px dashed #cfeff7;border-radius:14px;padding:12px}.arrow{stroke:#12b4a6;stroke-width:2;fill:none;stroke-linecap:round;stroke-dasharray:6 6;animation:dash 1.6s linear infinite}
  @keyframes dash{to{stroke-dashoffset:-100}}
</style>
</head>
<body>
<header>
  <div class="wrap" style="display:flex;align-items:center;justify-content:space-between;">
    <div class="brand"><div class="logo"></div>çµŒç†1ã‹æœˆã‚¹ãƒˆãƒ¼ãƒªãƒ¼å­¦ç¿’ <span class="pill">v3 æ¼”å‡ºå¼·åŒ–</span></div>
    <div class="row">
      <div class="progress" style="width:280px;"><div id="bar" class="bar"></div></div>
      <div class="mono" id="pct" style="min-width:48px;text-align:right;">0%</div>
      <div class="mono" id="remain" style="min-width:90px;text-align:right;color:#64748b;">æ®‹ã‚Š 10æ—¥</div>
    </div>
  </div>
</header>

<main class="wrap">
  <section id="top">
    <div class="top">
      <div class="card">
        <div class="head"><div>ã¯ã˜ã‚ã«</div></div>
        <div class="body">
          <h2 style="margin:0 0 6px;">æœˆåˆã‹ã‚‰æœˆæœ«ã¾ã§ã€å®Ÿå‹™ã®çµŒç†ã‚’ä½“é¨“ã—ã‚ˆã†ã€‚</h2>
          <p class="muted">ã‚ãªãŸã¯ä»Šæ—¥ã‹ã‚‰Aç¤¾ã®çµŒç†æ‹…å½“ã€‚ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’èª­ã¿ã€freeeé¢¨ãƒ•ã‚©ãƒ¼ãƒ ã§ä»•è¨³ã‚’å…¥åŠ›ã—ã¾ã™ã€‚</p>
          <div class="row" style="margin:10px 0 16px;">
            <button class="btn primary" onclick="startFromBeginning()">æœˆåˆã‹ã‚‰å§‹ã‚ã‚‹</button>
            <button class="btn" onclick="openDays()">Dayä¸€è¦§ã‚’è¦‹ã‚‹</button>
          </div>
          <div class="navdays" id="nav_days"></div>
        </div>
      </div>
      <div class="card center">
        <div class="head"><div>ã‚¤ãƒ¡ãƒ¼ã‚¸</div></div>
        <div class="body">
          <svg viewBox="0 0 420 260" xmlns="http://www.w3.org/2000/svg">
            <defs><linearGradient id="gTop" x1="0" x2="1"><stop offset="0" stop-color="#3bb3df"/><stop offset="1" stop-color="#12b4a6"/></linearGradient></defs>
            <rect x="0" y="0" width="420" height="260" rx="18" fill="#f2fbff"/>
            <circle cx="70" cy="70" r="40" fill="url(#gTop)" opacity="0.25"/>
            <circle cx="340" cy="190" r="28" fill="url(#gTop)" opacity="0.25"/>
            <rect x="30" y="180" width="360" height="40" rx="8" fill="#e6f7f5" stroke="#d0eeea"/>
            <rect x="120" y="120" width="180" height="60" rx="8" fill="#fff" stroke="#e2e8f0"/>
            <rect x="135" y="135" width="150" height="12" rx="6" fill="#3bb3df" opacity="0.6"/>
            <rect x="135" y="155" width="120" height="8" rx="4" fill="#cfeff7"/>
            <circle cx="80" cy="140" r="16" fill="#3bb3df" opacity="0.85"/>
            <rect x="70" y="154" width="20" height="24" rx="6" fill="#a3dbf0"/>
            <rect x="320" y="40" width="70" height="90" rx="10" fill="#f0fff9" stroke="#d1fae5"/>
            <path d="M335 95 L355 75 L375 95" stroke="#10b981" stroke-width="6" fill="none" stroke-linecap="round"/>
          </svg>
          <div class="muted" style="margin-top:8px;">â€» è‡ªä½œSVGã‚¤ãƒ©ã‚¹ãƒˆã€‚</div>
        </div>
      </div>
    </div>
    <div class="footer">ä¿å­˜ã¯ç«¯æœ«å†…ï¼ˆlocalStorageï¼‰ã€‚ãƒ­ã‚°ã‚¤ãƒ³ä¸è¦ã§å­¦ã¹ã¾ã™ã€‚</div>
  </section>

  <section id="lesson" style="display:none;">
    <div class="card">
      <div class="head"><div id="day_title">Day 1</div><div class="pill mono" id="day_idx">1 / 10</div></div>
      <div class="body">
        <div class="scene">
          <div><svg id="day_svg" viewBox="0 0 420 220" xmlns="http://www.w3.org/2000/svg"></svg></div>
          <div>
            <p id="s1" class="muted">â€”</p><p id="s2" class="muted">â€”</p><p id="s3" class="muted">â€”</p>
            <div class="row" style="margin-top:10px;">
              <button class="btn" onclick="backToTop()">ãƒˆãƒƒãƒ—ã¸æˆ»ã‚‹</button>
              <button class="btn primary" onclick="focusEntry()">ä»•è¨³ã«é€²ã‚€</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="grid two" style="margin-top:12px;">
      <div class="card">
        <div class="head"><div>ä»•è¨³å…¥åŠ›ï¼ˆfreeeé¢¨UIï¼‰</div></div>
        <div class="body">
          <div class="grid" style="grid-template-columns:1fr 1fr; gap:10px;">
            <div><label>å€Ÿæ–¹ç§‘ç›®</label>
              <select id="d_k">
                <option>å£²æ›é‡‘</option><option>å½“åº§é é‡‘</option><option>æ™®é€šé é‡‘</option><option>ç¾é‡‘</option>
                <option>é€šä¿¡è²»</option><option>æ—…è²»äº¤é€šè²»</option><option>å‰æ‰•è²»ç”¨</option><option>æ¸›ä¾¡å„Ÿå´è²»</option><option>ä»®æ‰•é‡‘</option>
                <option>å•†å“</option><option>ä»•å…¥</option><option>æ£šå¸æ¸›è€—æ</option><option>ç§Ÿç¨å…¬èª²</option><option>æ³•äººç¨ç­‰</option><option>æ¶ˆè€—å“è²»</option>
              </select>
            </div>
            <div><label>å€Ÿæ–¹é‡‘é¡</label><input id="d_a" placeholder="110000"></div>
            <div><label>è²¸æ–¹ç§‘ç›®</label>
              <select id="c_k">
                <option>å£²ä¸Šé«˜</option><option>ä»®å—æ¶ˆè²»ç¨</option><option>å£²æ›é‡‘</option><option>æœªæ‰•è²»ç”¨</option><option>æœªæ‰•é‡‘</option>
                <option>æ¸›ä¾¡å„Ÿå´ç´¯è¨ˆé¡</option><option>å‰å—é‡‘</option><option>æ™®é€šé é‡‘</option><option>å½“åº§é é‡‘</option><option>ç¾é‡‘</option><option>ä»®æ‰•é‡‘</option>
                <option>è²·æ›é‡‘</option><option>æ£šå¸è³‡ç”£</option><option>æœªæ‰•æ³•äººç¨ç­‰</option><option>ç«‹æ›¿é‡‘</option>
              </select>
            </div>
            <div><label>è²¸æ–¹é‡‘é¡</label><input id="c_a" placeholder="100000"></div>
            <div style="grid-column:1 / -1;"><label>ãƒ¡ãƒ¢ï¼ˆä»»æ„ï¼‰</label><input id="memo" placeholder="ä¾‹ï¼šBç¤¾ 4æœˆç´å“åˆ† è«‹æ±‚æ›¸No.1234"></div>
          </div>
          <div class="row" style="margin-top:12px; justify-content:space-between;">
            <div id="msg" class="muted"></div>
            <div class="row">
              <button class="btn" onclick="skipDay()">ã‚¹ã‚­ãƒƒãƒ—</button>
              <button class="btn primary" onclick="grade()">æ¡ç‚¹</button>
            </div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="head"><div>è§£èª¬ï¼ˆå›³è§£ãƒ»å‹•ãçŸ¢å°ï¼‰</div></div>
        <div class="body"><div id="explain" class="diagram"></div></div>
      </div>
    </div>

    <div class="row" style="margin-top:10px; justify-content:flex-end;">
      <button class="btn" onclick="openDays()">Dayä¸€è¦§ã¸</button>
      <button class="btn primary" id="next_btn" onclick="nextDay()" disabled>æ¬¡ã®æ—¥ã¸</button>
    </div>
  </section>

  <section id="days" style="display:none; margin-top:10px;">
    <div class="card">
      <div class="head"><div>Dayä¸€è¦§ï¼ˆã‚¯ãƒªãƒƒã‚¯ã§ç§»å‹•ï¼‰</div></div>
      <div class="body"><div class="navdays" id="days_list"></div></div>
    </div>
  </section>
</main>

<canvas id="confetti"></canvas>
<div id="reward" class="modal">
  <div class="box">
    <div class="badge">NICE!</div>
    <div id="medal" class="medal"></div>
    <h3 id="tierTitle" style="margin:6px 0 4px;">ã‚¯ãƒªã‚¢ï¼</h3>
    <div class="muted" id="tierDesc">ä»Šæ—¥ã®ãƒŸãƒƒã‚·ãƒ§ãƒ³ã‚’é”æˆã€‚æ¬¡ã®æ—¥ã¸é€²ã‚‚ã†ï¼</div>
    <div class="row" style="justify-content:center; margin-top:10px;">
      <button class="btn" onclick="closeReward()">é–‰ã˜ã‚‹</button>
      <button class="btn primary" onclick="nextDay(); closeReward()">æ¬¡ã®æ—¥ã¸</button>
    </div>
  </div>
</div>

<div id="toast" class="toast">ä¿å­˜ã—ã¾ã—ãŸã€‚</div>

<script>
const DAYS=[
{id:'d1',title:'Day1ï¼ˆæœˆåˆï¼‰è«‹æ±‚ã®è¨ˆä¸Š',scene:['æœˆåˆã€å…ˆæœˆç´å“åˆ†ã®è«‹æ±‚æ›¸ã‚’ç™ºè¡Œã—ã¾ã™ã€‚','Bç¤¾ã¸ç¨æŠœ100,000å††ï¼ˆæ¶ˆè²»ç¨10%ï¼‰ã€‚ç· æ—¥ã¯4/30ã€å…¥é‡‘ã¯ç¿Œæœˆæœ«äºˆå®šã€‚','ä¼šè¨ˆã«ã¯å£²æ›é‡‘ã‚’è¨ˆä¸Šã—ã¾ã—ã‚‡ã†ã€‚'],point:'å£²æ›é‡‘ã®è¨ˆä¸Šï¼ˆå¤–ç¨/å†…ç¨ã©ã¡ã‚‰ã§ã‚‚OKï¼‰',hint:'å€Ÿæ–¹ï¼šå£²æ›é‡‘ 110,000 / è²¸æ–¹ï¼šå£²ä¸Šé«˜ 100,000, ä»®å—æ¶ˆè²»ç¨ 10,000ï¼ˆå†…ç¨ã§ã‚‚110,000/å£²ä¸Šé«˜ã§å¯ï¼‰',expects:[{dK:'å£²æ›é‡‘',dA:110000,cK:'å£²ä¸Šé«˜',cA:100000,altK:'ä»®å—æ¶ˆè²»ç¨',altA:10000,mode:'split'},{dK:'å£²æ›é‡‘',dA:110000,cK:'å£²ä¸Šé«˜',cA:110000,mode:'gross'}],svg:'invoice',confetti:100},
{id:'d2',title:'Day2 å…¥é‡‘ã®æ¶ˆè¾¼',scene:['éŠ€è¡Œã«Bç¤¾ã‹ã‚‰ã®å…¥é‡‘ãŒã‚ã‚Šã¾ã—ãŸã€‚','é‡‘é¡ã¯110,000å††ã€æ‰‹æ•°æ–™ãªã—ã§ã™ã€‚','å¯¾å¿œã™ã‚‹å£²æ›é‡‘ã‚’æ¶ˆã—è¾¼ã¿ã¾ã™ã€‚'],point:'å…¥é‡‘ã¯é é‡‘ã®å¢—åŠ ã€ç›¸æ‰‹ã¯å£²æ›é‡‘ã§æ¶ˆè¾¼',hint:'å€Ÿæ–¹ï¼šå½“åº§/æ™®é€š/ç¾é‡‘ 110,000 / è²¸æ–¹ï¼šå£²æ›é‡‘ 110,000',expects:[{dKAny:['å½“åº§é é‡‘','æ™®é€šé é‡‘','ç¾é‡‘'],dA:110000,cK:'å£²æ›é‡‘',cA:110000}],svg:'bank',confetti:120},
{id:'d3',title:'Day3 çµŒè²»ã®æœªæ‰•è¨ˆä¸Š',scene:['4æœˆåˆ†ã®é€šä¿¡è²»ã®è«‹æ±‚æ›¸ãŒæœªç€ã®ã¾ã¾æœˆæ¬¡ç· ã‚ãŒè¿‘ã¥ã„ã¦ã„ã¾ã™ã€‚','ç™ºç”Ÿã—ã¦ã„ã‚‹è²»ç”¨ã‚’å½“æœˆã«è¨ˆä¸Šã™ã‚‹ãŸã‚ã€æœªæ‰•è¨ˆä¸ŠãŒå¿…è¦ã§ã™ã€‚','ç¨è¾¼22,000å††ã¨ã—ã¦å‡¦ç†ã—ã¾ã—ã‚‡ã†ã€‚'],point:'ç™ºç”Ÿä¸»ç¾©ï¼šé€šä¿¡è²»ã¯å½“æœˆã«æœªæ‰•è¨ˆä¸Š',hint:'å€Ÿæ–¹ï¼šé€šä¿¡è²» 22,000 / è²¸æ–¹ï¼šæœªæ‰•è²»ç”¨ 22,000',expects:[{dK:'é€šä¿¡è²»',dA:22000,cK:'æœªæ‰•è²»ç”¨',cA:22000}],svg:'expense',confetti:130},
{id:'d4',title:'Day4 å‰æ‰•è²»ç”¨ã®è¨ˆä¸Š',scene:['SaaSãƒ„ãƒ¼ãƒ«å¹´é¡132,000å††ï¼ˆ5/1ã€œç¿Œ4/30ï¼‰ã‚’å…ˆæ‰•ã„ã—ã¾ã—ãŸã€‚','æä¾›å‰ã®ã‚µãƒ¼ãƒ“ã‚¹å¯¾ä¾¡ã¯è³‡ç”£ï¼ˆå‰æ‰•è²»ç”¨ï¼‰ã§è¨ˆä¸Šã—ã¾ã™ã€‚','æ”¯æ‰•ã¯æ™®é€šé é‡‘ã‹ã‚‰ã€‚'],point:'å‰æ‰•è²»ç”¨ã®è³‡ç”£è¨ˆä¸Š',hint:'å€Ÿæ–¹ï¼šå‰æ‰•è²»ç”¨ 132,000 / è²¸æ–¹ï¼šæ™®é€šé é‡‘ï¼ˆã¾ãŸã¯å½“åº§ï¼‰ 132,000',expects:[{dK:'å‰æ‰•è²»ç”¨',dA:132000,cKAny:['æ™®é€šé é‡‘','å½“åº§é é‡‘','ç¾é‡‘'],cA:132000}],svg:'prepaid',confetti:140},
{id:'d5',title:'Day5 æœˆæœ«ã®æ¸›ä¾¡å„Ÿå´',scene:['å–å¾—ä¾¡é¡200,000å††ã®å‚™å“ï¼ˆè€ç”¨å¹´æ•°5å¹´ã€å®šé¡æ³•ã€æ®‹å­˜ãªã—ï¼‰ã€‚','æœˆæœ«ã«å½“æœˆåˆ†ã®æ¸›ä¾¡å„Ÿå´ã‚’è¨ˆä¸Šã—ã¾ã™ã€‚','æœˆé¡ã¯ãŠã‚ˆã3,333å††ï¼ˆç«¯æ•°OKï¼‰ã€‚'],point:'æ¸›ä¾¡å„Ÿå´è²» / æ¸›ä¾¡å„Ÿå´ç´¯è¨ˆé¡ï¼ˆç«¯æ•°Â±1è¨±å®¹ï¼‰',hint:'å€Ÿæ–¹ï¼šæ¸›ä¾¡å„Ÿå´è²» 3,333 / è²¸æ–¹ï¼šæ¸›ä¾¡å„Ÿå´ç´¯è¨ˆé¡ 3,333',expects:[{dK:'æ¸›ä¾¡å„Ÿå´è²»',dAAny:[3333,3334],cK:'æ¸›ä¾¡å„Ÿå´ç´¯è¨ˆé¡',cAAny:[3333,3334]}],svg:'depr',confetti:160},
{id:'d6',title:'Day6 ä»®æ‰•é‡‘ã®ç²¾ç®—ï¼ˆæ—…è²»ï¼‰',scene:['å–¶æ¥­ã®å‡ºå¼µã§å…ˆã«ä»®æ‰•é‡‘15,000å††ã‚’æ¸¡ã—ã¦ã„ã¾ã—ãŸã€‚','é ˜åæ›¸ã®æå‡ºãŒã‚ã‚Šã€æ—…è²»äº¤é€šè²»ã¨ã—ã¦ç²¾ç®—ã—ã¾ã™ã€‚','å·®é¡ãªã—ã§ã®ç²¾ç®—ã§ã™ã€‚'],point:'æ—…è²»äº¤é€šè²» / ä»®æ‰•é‡‘ï¼ˆä»®æ‰•ã®æ¶ˆã—è¾¼ã¿ï¼‰',hint:'å€Ÿæ–¹ï¼šæ—…è²»äº¤é€šè²» 15,000 / è²¸æ–¹ï¼šä»®æ‰•é‡‘ 15,000',expects:[{dK:'æ—…è²»äº¤é€šè²»',dA:15000,cK:'ä»®æ‰•é‡‘',cA:15000}],svg:'travel',confetti:170},
{id:'d7',title:'Day7 å£²ä¸Šè¨ˆä¸Šæ¼ã‚Œã®ä¿®æ­£',scene:['æœˆæ¬¡ç· ã‚ã®ç›´å‰ã€å£²ä¸Šã®è¨ˆä¸Šæ¼ã‚Œï¼ˆç¨æŠœ50,000ï¼‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸã€‚','å½“æœˆåˆ†ã¨ã—ã¦å£²æ›é‡‘ã‚’è¿½åŠ è¨ˆä¸Šã—ã¾ã™ï¼ˆæ¶ˆè²»ç¨10%ï¼‰ã€‚','é–¢ä¿‚è€…ã¸å…±æœ‰ã—ã¦ç· ã‚ã‚’å®Œäº†ã—ã¾ã™ã€‚'],point:'å£²æ›é‡‘ã®è¿½åŠ è¨ˆä¸Šï¼ˆå¤–ç¨/å†…ç¨ã©ã¡ã‚‰ã§ã‚‚OKï¼‰',hint:'å€Ÿæ–¹ï¼šå£²æ›é‡‘ 55,000 / è²¸æ–¹ï¼šå£²ä¸Šé«˜ 50,000, ä»®å—æ¶ˆè²»ç¨ 5,000ï¼ˆå†…ç¨55,000/å£²ä¸Šé«˜ã‚‚OKï¼‰',expects:[{dK:'å£²æ›é‡‘',dA:55000,cK:'å£²ä¸Šé«˜',cA:50000,altK:'ä»®å—æ¶ˆè²»ç¨',altA:5000,mode:'split'},{dK:'å£²æ›é‡‘',dA:55000,cK:'å£²ä¸Šé«˜',cA:55000,mode:'gross'}],svg:'close',confetti:180},
{id:'d8',title:'Day8 å‰å—é‡‘ã®å‡¦ç†',scene:['é•·æœŸå¥‘ç´„ã®å‰å—ã¨ã—ã¦66,000å††ã‚’å—é ˜ã—ã¾ã—ãŸï¼ˆç¨10%å†…ç¨ï¼‰ã€‚','ã¾ã ã‚µãƒ¼ãƒ“ã‚¹æä¾›å‰ã®ãŸã‚ã€åç›Šã§ã¯ãªãè² å‚µå‡¦ç†ã—ã¾ã™ã€‚','é é‡‘ã§å—ã‘å–ã‚Šã¾ã—ãŸã€‚'],point:'å‰å—é‡‘ã®è² å‚µè¨ˆä¸Š',hint:'å€Ÿæ–¹ï¼šå½“åº§/æ™®é€š/ç¾é‡‘ 66,000 / è²¸æ–¹ï¼šå‰å—é‡‘ 66,000',expects:[{dKAny:['å½“åº§é é‡‘','æ™®é€šé é‡‘','ç¾é‡‘'],dA:66000,cK:'å‰å—é‡‘',cA:66000}],svg:'advance',confetti:190},
{id:'d9',title:'Day9 ç«‹æ›¿é‡‘ã®ç²¾ç®—',scene:['ç·å‹™ãŒç«‹ã¦æ›¿ãˆãŸå‚™å“ä»£ 8,800å††ï¼ˆç¨è¾¼ï¼‰ã‚’ç²¾ç®—ã—ã¾ã™ã€‚','å‹˜å®šã¯æ¶ˆè€—å“è²»ã€æ”¯æ‰•ã¯æ™®é€šé é‡‘ã‹ã‚‰ã€‚','ç«‹æ›¿é‡‘ã®æ¶ˆã—è¾¼ã¿ã§ã™ã€‚'],point:'ç«‹æ›¿é‡‘ç²¾ç®—ï¼šè²»ç”¨ / ç«‹æ›¿é‡‘',hint:'å€Ÿæ–¹ï¼šæ¶ˆè€—å“è²» 8,800 / è²¸æ–¹ï¼šç«‹æ›¿é‡‘ 8,800ï¼ˆæ”¯æ‰•ã§ã‚ã‚Œã° ç«‹æ›¿é‡‘ / æ™®é€šé é‡‘ï¼‰',expects:[{dK:'æ¶ˆè€—å“è²»',dA:8800,cK:'ç«‹æ›¿é‡‘',cA:8800}],svg:'petty',confetti:200},
{id:'d10',title:'Day10 æ³•äººç¨ç­‰ã®ä»®è¨ˆä¸Š',scene:['æ±ºç®—è¦‹è¾¼ã¿ã§æ³•äººç¨ç­‰ã‚’ä»®è¨ˆä¸Šã—ã¾ã™ï¼ˆ100,000å††ï¼‰ã€‚','ç´ä»˜ã¯å¾Œæ—¥äºˆå®šã€‚','ã¾ãšã¯è² å‚µã¨ã—ã¦è¨ˆä¸Šã€‚'],point:'æ³•äººç¨ç­‰ / æœªæ‰•æ³•äººç¨ç­‰',hint:'å€Ÿæ–¹ï¼šæ³•äººç¨ç­‰ 100,000 / è²¸æ–¹ï¼šæœªæ‰•æ³•äººç¨ç­‰ 100,000',expects:[{dK:'æ³•äººç¨ç­‰',dA:100000,cK:'æœªæ‰•æ³•äººç¨ç­‰',cA:100000}],svg:'tax',confetti:220}
];

function sceneSVG(key){
  const base=(accent)=>`<rect x="0" y="0" width="420" height="220" rx="16" fill="#fff" stroke="#e2e8f0"/><circle cx="360" cy="50" r="20" fill="${accent}" opacity="0.25"/><circle cx="50" cy="180" r="18" fill="${accent}" opacity="0.25"/>`;
  const s={
    invoice:`<g>${base('#3bb3df')}<rect x="30" y="26" width="120" height="18" rx="9" fill="#3bb3df" opacity=".9"/><rect x="30" y="60" width="180" height="10" rx="5" fill="#cfeff7"/><rect x="30" y="78" width="200" height="10" rx="5" fill="#e6f7f5"/><rect x="30" y="110" width="360" height="80" rx="10" fill="#f7fbff" stroke="#e2e8f0"/><rect x="60" y="130" width="120" height="12" rx="6" fill="#12b4a6" opacity=".7"/><rect x="60" y="150" width="200" height="12" rx="6" fill="#cfeff7"/></g>`,
    bank:`<g>${base('#12b4a6')}<rect x="40" y="30" width="100" height="60" rx="10" fill="#f0fff9" stroke="#d1fae5"/><path d="M56 66 L85 45 L108 70" stroke="#10b981" stroke-width="6" fill="none" stroke-linecap="round"/><rect x="170" y="30" width="220" height="30" rx="8" fill="#e6f7f5" stroke="#d0eeea"/><rect x="170" y="70" width="160" height="10" rx="5" fill="#cfeff7"/><rect x="170" y="90" width="190" height="10" rx="5" fill="#e6f7f5"/></g>`,
    expense:`<g>${base('#3bb3df')}<rect x="40" y="30" width="80" height="80" rx="12" fill="#fff" stroke="#e2e8f0"/><rect x="60" y="46" width="40" height="10" rx="5" fill="#3bb3df"/><rect x="180" y="40" width="200" height="18" rx="9" fill="#e6f7f5"/><rect x="180" y="70" width="160" height="10" rx="5" fill="#cfeff7"/><rect x="180" y="88" width="140" height="10" rx="5" fill="#e6f7f5"/></g>`,
    prepaid:`<g>${base('#12b4a6')}<rect x="40" y="30" width="140" height="40" rx="10" fill="#12b4a6" opacity=".85"/><rect x="200" y="30" width="180" height="40" rx="10" fill="#a3dbf0"/><rect x="40" y="90" width="340" height="20" rx="10" fill="#e6f7f5"/><rect x="40" y="120" width="260" height="10" rx="5" fill="#cfeff7"/></g>`,
    depr:`<g>${base('#3bb3df')}<rect x="40" y="30" width="340" height="30" rx="8" fill="#f0fff9" stroke="#d1fae5"/><rect x="60" y="40" width="120" height="12" rx="6" fill="#10b981"/><rect x="200" y="40" width="120" height="12" rx="6" fill="#a7f3d0"/><rect x="60" y="90" width="300" height="12" rx="6" fill="#cfeff7"/><rect x="60" y="110" width="220" height="12" rx="6" fill="#e6f7f5"/></g>`,
    travel:`<g>${base('#3bb3df')}<rect x="30" y="30" width="120" height="80" rx="12" fill="#fff" stroke="#e2e8f0"/><circle cx="90" cy="70" r="22" fill="#3bb3df" opacity=".85"/><rect x="180" y="30" width="200" height="18" rx="9" fill="#e6f7f5"/><rect x="180" y="60" width="160" height="10" rx="5" fill="#cfeff7"/><rect x="180" y="78" width="140" height="10" rx="5" fill="#e6f7f5"/></g>`,
    close:`<g>${base('#12b4a6')}<rect x="40" y="30" width="80" height="80" rx="12" fill="#f0fff9" stroke="#d1fae5"/><path d="M56 82 L85 55 L108 86" stroke="#10b981" stroke-width="6" fill="none" stroke-linecap="round"/><rect x="150" y="30" width="230" height="30" rx="8" fill="#e6f7f5"/><rect x="150" y="70" width="200" height="10" rx="5" fill="#cfeff7"/><rect x="150" y="90" width="160" height="10" rx="5" fill="#e6f7f5"/></g>`,
    advance:`<g>${base('#12b4a6')}<rect x="40" y="30" width="100" height="60" rx="10" fill="#f0fff9" stroke="#d1fae5"/><path d="M56 66 L85 45 L108 70" stroke="#10b981" stroke-width="6" fill="none" stroke-linecap="round"/><rect x="170" y="30" width="220" height="30" rx="8" fill="#e6f7f5" stroke="#d0eeea"/><rect x="170" y="70" width="160" height="10" rx="5" fill="#cfeff7"/><rect x="170" y="90" width="190" height="10" rx="5" fill="#e6f7f5"/></g>`,
    petty:`<g>${base('#3bb3df')}<rect x="40" y="30" width="100" height="60" rx="10" fill="#fff" stroke="#e2e8f0"/><rect x="60" y="46" width="60" height="10" rx="5" fill="#3bb3df"/><rect x="170" y="30" width="220" height="30" rx="8" fill="#e6f7f5" stroke="#d0eeea"/><rect x="170" y="70" width="160" height="10" rx="5" fill="#cfeff7"/><rect x="170" y="90" width="190" height="10" rx="5" fill="#e6f7f5"/></g>`,
    tax:`<g>${base('#3bb3df')}<rect x="40" y="30" width="80" height="80" rx="12" fill="#f0fff9" stroke="#d1fae5"/><rect x="150" y="30" width="230" height="30" rx="8" fill="#e6f7f5"/><rect x="150" y="70" width="200" height="10" rx="5" fill="#cfeff7"/><rect x="150" y="90" width="160" height="10" rx="5" fill="#e6f7f5"/></g>`
  }; return s[key]||'';
}

function explainSVG(day){
  const a='<path class="arrow" d="M0 0 L60 0" />';
  if(day.id==='d1'||day.id==='d7'){return `<svg viewBox="0 0 560 190" xmlns="http://www.w3.org/2000/svg"><rect x="0" y="0" width="560" height="190" rx="14" fill="#fff" stroke="#e2e8f0"/><text x="20" y="24" fill="#0f172a" font-size="14" font-weight="700">å£²æ›é‡‘ã®è¨ˆä¸Šï¼ˆTå­—å‹˜å®šï¼‰</text><rect x="20" y="40" width="230" height="120" rx="10" fill="#f8feff" stroke="#cfeff7"/><rect x="310" y="40" width="230" height="120" rx="10" fill="#f8feff" stroke="#cfeff7"/><text x="30" y="58" fill="#0f172a" font-size="12">å€Ÿæ–¹ï¼šå£²æ›é‡‘</text><text x="320" y="58" fill="#0f172a" font-size="12">è²¸æ–¹ï¼šå£²ä¸Šé«˜ / ä»®å—æ¶ˆè²»ç¨</text><line x1="30" y1="70" x2="240" y2="70" stroke="#e2e8f0"/><line x1="320" y1="70" x2="530" y2="70" stroke="#e2e8f0"/><text x="40" y="98" fill="#12b4a6" font-size="20" font-weight="800">110,000</text><text x="330" y="98" fill="#3bb3df" font-size="16" font-weight="700">100,000</text><text x="330" y="122" fill="#3bb3df" font-size="16" font-weight="700">10,000</text><text x="330" y="148" fill="#64748b" font-size="11">ï¼ˆå†…ç¨ãªã‚‰è²¸æ–¹ã¯å£²ä¸Šé«˜ 110,000ï¼‰</text><g transform="translate(255,100)"><g>${a}<polygon points="60,-4 70,0 60,4" fill="#12b4a6"/></g></g></svg>`;}
  if(day.id==='d2'){return `<svg viewBox="0 0 560 170" xmlns="http://www.w3.org/2000/svg"><rect x="0" y="0" width="560" height="170" rx="14" fill="#fff" stroke="#e2e8f0"/><text x="20" y="24" fill="#0f172a" font-size="14" font-weight="700">å…¥é‡‘æ¶ˆè¾¼ã®æµã‚Œ</text><rect x="30" y="60" width="120" height="40" rx="10" fill="#e6f7f5" stroke="#cfeff7"/><text x="52" y="85" fill="#0a5e57" font-size="12">éŠ€è¡Œå…¥é‡‘</text><g transform="translate(150,80)"><path class="arrow" d="M0 0 L60 0"/><polygon points="60,-4 70,0 60,4" fill="#12b4a6"/></g><rect x="220" y="60" width="120" height="40" rx="10" fill="#f0fff9" stroke="#d1fae5"/><text x="235" y="85" fill="#059669" font-size="12">é é‡‘ã®å¢—åŠ </text><g transform="translate(340,80)"><path class="arrow" d="M0 0 L60 0"/><polygon points="60,-4 70,0 60,4" fill="#12b4a6"/></g><rect x="410" y="60" width="120" height="40" rx="10" fill="#fff" stroke="#e2e8f0"/><text x="432" y="85" fill="#334155" font-size="12">å£²æ›é‡‘æ¶ˆè¾¼</text></svg>`;}
  if(day.id==='d3'){return `<svg viewBox="0 0 560 170" xmlns="http://www.w3.org/2000/svg"><rect x="0" y="0" width="560" height="170" rx="14" fill="#fff" stroke="#e2e8f0"/><text x="20" y="24" fill="#0f172a" font-size="14" font-weight="700">æœªæ‰•è¨ˆä¸Šã®è€ƒãˆæ–¹ï¼ˆç™ºç”Ÿä¸»ç¾©ï¼‰</text><rect x="30" y="60" width="160" height="40" rx="10" fill="#f8feff" stroke="#cfeff7"/><text x="40" y="85" fill="#0a5e57" font-size="12">4æœˆã«è²»ç”¨ãŒç™ºç”Ÿ</text><g transform="translate(190,80)"><path class="arrow" d="M0 0 L60 0"/><polygon points="60,-4 70,0 60,4" fill="#12b4a6"/></g><rect x="260" y="60" width="120" height="40" rx="10" fill="#fff" stroke="#e2e8f0"/><text x="268" y="85" fill="#334155" font-size="12">é€šä¿¡è²»</text><g transform="translate(380,80)"><path class="arrow" d="M0 0 L60 0"/><polygon points="60,-4 70,0 60,4" fill="#12b4a6"/></g><rect x="450" y="60" width="80" height="40" rx="10" fill="#f0fff9" stroke="#d1fae5"/><text x="458" y="85" fill="#059669" font-size="12">æœªæ‰•</text></svg>`;}
  if(day.id==='d4'){return `<svg viewBox="0 0 560 170" xmlns="http://www.w3.org/2000/svg"><rect x="0" y="0" width="560" height="170" rx="14" fill="#fff" stroke="#e2e8f0"/><text x="20" y="24" fill="#0f172a" font-size="14" font-weight="700">å‰æ‰•è²»ç”¨ã®æµã‚Œï¼ˆè³‡ç”£â†’è²»ç”¨ï¼‰</text><rect x="30" y="60" width="120" height="40" rx="10" fill="#f0fff9" stroke="#d1fae5"/><text x="44" y="85" fill="#059669" font-size="12">æ”¯æ‰•ï¼ˆé é‡‘ï¼‰</text><g transform="translate(150,80)"><path class="arrow" d="M0 0 L60 0"/><polygon points="60,-4 70,0 60,4" fill="#12b4a6"/></g><rect x="220" y="60" width="120" height="40" rx="10" fill="#e6f7f5" stroke="#cfeff7"/><text x="234" y="85" fill="#0a5e57" font-size="12">å‰æ‰•è²»ç”¨</text><g transform="translate(340,80)"><path class="arrow" d="M0 0 L60 0"/><polygon points="60,-4 70,0 60,4" fill="#12b4a6"/></g><rect x="410" y="60" width="120" height="40" rx="10" fill="#fff" stroke="#e2e8f0"/><text x="432" y="85" fill="#334155" font-size="12">æŒ‰åˆ†â†’è²»ç”¨åŒ–</text></svg>`;}
  if(day.id==='d5'){return `<svg viewBox="0 0 560 170" xmlns="http://www.w3.org/2000/svg"><rect x="0" y="0" width="560" height="170" rx="14" fill="#fff" stroke="#e2e8f0"/><text x="20" y="24" fill="#0f172a" font-size="14" font-weight="700">æ¸›ä¾¡å„Ÿå´ã®ã‚¤ãƒ¡ãƒ¼ã‚¸</text><rect x="30" y="60" width="120" height="40" rx="10" fill="#f8feff" stroke="#cfeff7"/><text x="50" y="85" fill="#0a5e57" font-size="12">å›ºå®šè³‡ç”£</text><g transform="translate(150,80)"><path class="arrow" d="M0 0 L60 0"/><polygon points="60,-4 70,0 60,4" fill="#12b4a6"/></g><rect x="220" y="60" width="140" height="40" rx="10" fill="#fff" stroke="#e2e8f0"/><text x="230" y="85" fill="#334155" font-size="12">æ¸›ä¾¡å„Ÿå´è²»</text><g transform="translate(360,80)"><path class="arrow" d="M0 0 L60 0"/><polygon points="60,-4 70,0 60,4" fill="#12b4a6"/></g><rect x="430" y="60" width="100" height="40" rx="10" fill="#f0fff9" stroke="#d1fae5"/><text x="438" y="85" fill="#059669" font-size="12">ç´¯è¨ˆé¡</text></svg>`;}
  if(day.id==='d6'){return `<svg viewBox="0 0 560 170" xmlns="http://www.w3.org/2000/svg"><rect x="0" y="0" width="560" height="170" rx="14" fill="#fff" stroke="#e2e8f0"/><text x="20" y="24" fill="#0f172a" font-size="14" font-weight="700">ä»®æ‰•â†’ç²¾ç®—ã®æµã‚Œ</text><rect x="30" y="60" width="120" height="40" rx="10" fill="#e6f7f5" stroke="#cfeff7"/><text x="60" y="85" fill="#0a5e57" font-size="12">ä»®æ‰•</text><g transform="translate(150,80)"><path class="arrow" d="M0 0 L60 0"/><polygon points="60,-4 70,0 60,4" fill="#12b4a6"/></g><rect x="220" y="60" width="120" height="40" rx="10" fill="#fff" stroke="#e2e8f0"/><text x="228" y="85" fill="#334155" font-size="12">æ—…è²»äº¤é€šè²»</text><g transform="translate(340,80)"><path class="arrow" d="M0 0 L60 0"/><polygon points="60,-4 70,0 60,4" fill="#12b4a6"/></g><rect x="410" y="60" width="120" height="40" rx="10" fill="#f0fff9" stroke="#d1fae5"/><text x="438" y="85" fill="#059669" font-size="12">ç²¾ç®—å®Œäº†</text></svg>`;}
  if(day.id==='d8'){return `<svg viewBox="0 0 560 170" xmlns="http://www.w3.org/2000/svg"><rect x="0" y="0" width="560" height="170" rx="14" fill="#fff" stroke="#e2e8f0"/><text x="20" y="24" fill="#0f172a" font-size="14" font-weight="700">å‰å—é‡‘ï¼ˆå—é ˜â†’è² å‚µï¼‰</text><rect x="30" y="60" width="120" height="40" rx="10" fill="#f0fff9" stroke="#d1fae5"/><text x="50" y="85" fill="#059669" font-size="12">å…¥é‡‘</text><g transform="translate(150,80)"><path class="arrow" d="M0 0 L60 0"/><polygon points="60,-4 70,0 60,4" fill="#12b4a6"/></g><rect x="220" y="60" width="120" height="40" rx="10" fill="#e6f7f5" stroke="#cfeff7"/><text x="240" y="85" fill="#0a5e57" font-size="12">å‰å—é‡‘</text><g transform="translate(340,80)"><path class="arrow" d="M0 0 L60 0"/><polygon points="60,-4 70,0 60,4" fill="#12b4a6"/></g><rect x="410" y="60" width="120" height="40" rx="10" fill="#fff" stroke="#e2e8f0"/><text x="438" y="85" fill="#334155" font-size="12">æä¾›å¾Œã«åç›ŠåŒ–</text></svg>`;}
  if(day.id==='d9'){return `<svg viewBox="0 0 560 170" xmlns="http://www.w3.org/2000/svg"><rect x="0" y="0" width="560" height="170" rx="14" fill="#fff" stroke="#e2e8f0"/><text x="20" y="24" fill="#0f172a" font-size="14" font-weight="700">ç«‹æ›¿é‡‘ã®ç²¾ç®—</text><rect x="30" y="60" width="140" height="40" rx="10" fill="#e6f7f5" stroke="#cfeff7"/><text x="56" y="85" fill="#0a5e57" font-size="12">ç«‹æ›¿é‡‘ï¼ˆå¾“æ¥­å“¡ï¼‰</text><g transform="translate(170,80)"><path class="arrow" d="M0 0 L60 0"/><polygon points="60,-4 70,0 60,4" fill="#12b4a6"/></g><rect x="240" y="60" width="120" height="40" rx="10" fill="#fff" stroke="#e2e8f0"/><text x="258" y="85" fill="#334155" font-size="12">æ¶ˆè€—å“è²»</text><g transform="translate(360,80)"><path class="arrow" d="M0 0 L60 0"/><polygon points="60,-4 70,0 60,4" fill="#12b4a6"/></g><rect x="430" y="60" width="100" height="40" rx="10" fill="#f0fff9" stroke="#d1fae5"/><text x="442" y="85" fill="#059669" font-size="12">ç²¾ç®—</text></svg>`;}
  if(day.id==='d10'){return `<svg viewBox="0 0 560 170" xmlns="http://www.w3.org/2000/svg"><rect x="0" y="0" width="560" height="170" rx="14" fill="#fff" stroke="#e2e8f0"/><text x="20" y="24" fill="#0f172a" font-size="14" font-weight="700">æ³•äººç¨ç­‰ã®ä»®è¨ˆä¸Š</text><rect x="30" y="60" width="200" height="40" rx="10" fill="#f8feff" stroke="#cfeff7"/><text x="50" y="85" fill="#0a5e57" font-size="12">ç¨é¡è¦‹è¾¼ã¿ï¼ˆè¨ˆç®—ï¼‰</text><g transform="translate(230,80)"><path class="arrow" d="M0 0 L60 0"/><polygon points="60,-4 70,0 60,4" fill="#12b4a6"/></g><rect x="300" y="60" width="100" height="40" rx="10" fill="#fff" stroke="#e2e8f0"/><text x="310" y="85" fill="#334155" font-size="12">æ³•äººç¨ç­‰</text><g transform="translate(400,80)"><path class="arrow" d="M0 0 L60 0"/><polygon points="60,-4 70,0 60,4" fill="#12b4a6"/></g><rect x="470" y="60" width="60" height="40" rx="10" fill="#f0fff9" stroke="#d1fae5"/><text x="478" y="85" fill="#059669" font-size="12">æœªæ‰•</text></svg>`;}
  return '';
}

let idx=0;let progress=JSON.parse(localStorage.getItem('month_progress_v3')||'{"done":0,"total":'+DAYS.length+'}');let attempts=0;let startTime=0;
function updateBar(){const pct=Math.round((progress.done/Math.max(1,progress.total))*100);bar.style.width=pct+'%';pct.textContent=pct+'%';const remainDays=Math.max(0,DAYS.length-progress.done);remain.textContent='æ®‹ã‚Š '+remainDays+'æ—¥';}
function showToast(t){toast.textContent=t;toast.style.display='block';setTimeout(()=>toast.style.display='none',1500);}
const bar=document.getElementById('bar'),pct=document.getElementById('pct'),toast=document.getElementById('toast'),remain=document.getElementById('remain');

function startFromBeginning(){idx=0;openLesson(idx)}
function openDays(){topEl.style.display='none';lessonEl.style.display='none';daysEl.style.display='block';buildDays()}
function backToTop(){topEl.style.display='block';lessonEl.style.display='none';daysEl.style.display='none'}
function openLesson(i){idx=i;attempts=0;startTime=performance.now();const d=DAYS[i];topEl.style.display='none';lessonEl.style.display='block';daysEl.style.display='none';day_title.textContent=d.title;day_idx.textContent=(i+1)+' / '+DAYS.length;s1.textContent=d.scene[0]||'';s2.textContent=d.scene[1]||'';s3.textContent=d.scene[2]||'';day_svg.innerHTML=sceneSVG(d.svg);explain.innerHTML=explainSVG(d);d_k.value='å£²æ›é‡‘';d_a.value='';c_k.value='å£²ä¸Šé«˜';c_a.value='';msg.textContent='ã“ã®æ—¥ã®å–å¼•ã®ä»•è¨³ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚';next_btn.disabled=true;window.scrollTo({top:0,behavior:'smooth'})}
function buildDays(){const list=days_list;list.innerHTML='';DAYS.forEach((d,i)=>{const b=document.createElement('button');b.className='btn';b.textContent=(i+1)+'. '+d.title;b.addEventListener('click',()=>openLesson(i));list.appendChild(b)})}
(function buildNav(){nav_days.innerHTML='';DAYS.forEach((d,i)=>{const b=document.createElement('button');b.className='btn';b.textContent='Day'+(i+1);b.addEventListener('click',()=>openLesson(i));nav_days.appendChild(b)})})();
function focusEntry(){d_k.focus()}

function roughlyEqual(a,b){return Math.abs(a-b)<=1}
function grade(){attempts++;const d=DAYS[idx];const dK=d_k.value,dA=Number(d_a.value),cK=c_k.value,cA=Number(c_a.value);let ok=false;for(const ex of d.expects){const dKOK=ex.dKAny?ex.dKAny.includes(dK):(ex.dK?dK===ex.dK:true);const cKOK=ex.cKAny?ex.cKAny.includes(cK):(ex.cK?cK===ex.cK:true);const dAOK=ex.dAAny?ex.dAAny.some(x=>roughlyEqual(x,dA)):(typeof ex.dA==='number'?dA===ex.dA:true);const cAOK=ex.cAAny?ex.cAAny.some(x=>roughlyEqual(x,cA)):(typeof ex.cA==='number'?cA===ex.cA:true);if(dKOK&&cKOK&&dAOK&&cAOK){ok=true;break}}if(ok){msg.innerHTML='<span class="ok">ğŸ‰ æ­£è§£ï¼</span> '+d.hint;if(progress.done<idx+1){progress.done=idx+1;localStorage.setItem('month_progress_v3',JSON.stringify(progress));updateBar()}next_btn.disabled=false;const elapsed=(performance.now()-startTime)/1000;const tier=medalTier(attempts,elapsed);showMedal(tier);launchConfetti(d.confetti+tierBoost(tier))}else{msg.innerHTML='<span class="ng">âš  ã‚‚ã†ä¸€æ­©ã€‚</span> '+d.hint}}
function skipDay(){next_btn.disabled=false;msg.textContent='ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã—ãŸã€‚æ­£è§£ã¯ï¼š'+DAYS[idx].hint}
function nextDay(){if(idx<DAYS.length-1){openLesson(idx+1)}else{showToast('1ã‹æœˆåˆ†ï¼ˆ10æ—¥ï¼‰ã€å®Œäº†ï¼ãŠç–²ã‚Œã•ã¾ã§ã—ãŸã€‚');backToTop()}}

function medalTier(attempts,elapsed){if(attempts<=1&&elapsed<45)return'gold';if(attempts<=2&&elapsed<120)return'silver';return'bronze'}
function tierBoost(t){return t==='gold'?80:t==='silver'?40:0}

const confettiCanvas=document.getElementById('confetti');const ctx=confettiCanvas.getContext('2d');function resize(){confettiCanvas.width=window.innerWidth;confettiCanvas.height=window.innerHeight}window.addEventListener('resize',resize);resize();let confetti=[]
function launchConfetti(amount){const colors=['#12b4a6','#3bb3df','#a3dbf0','#10b981','#f59e0b','#ef4444'];confetti=Array.from({length:amount},(_,i)=>{const angle=Math.random()*Math.PI*2;const speed=2+Math.random()*4;return{x:confettiCanvas.width/2,y:0,vx:Math.cos(angle)*speed,vy:Math.sin(angle)*speed,size:6+Math.random()*6,color:colors[i%colors.length],rot:Math.random()*360,vr:(Math.random()-.5)*10,life:0,max:220}});animateConfetti()}
function animateConfetti(){let alive=false;ctx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height);confetti.forEach(p=>{p.life++;p.vy+=.08;p.x+=p.vx;p.y+=p.vy;p.rot+=p.vr;if(p.life<p.max&&p.y<confettiCanvas.height+30){alive=true}ctx.save();ctx.translate(p.x,p.y);ctx.rotate(p.rot*Math.PI/180);ctx.fillStyle=p.color;ctx.fillRect(-p.size/2,-p.size/2,p.size,p.size);ctx.restore()});if(alive)requestAnimationFrame(animateConfetti);else ctx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height)}

const reward=document.getElementById('reward'),medal=document.getElementById('medal'),tierTitle=document.getElementById('tierTitle'),tierDesc=document.getElementById('tierDesc')
function showMedal(t){reward.style.display='flex';let color='conic-gradient(from 0deg, var(--gold), #ffe08a, var(--gold))',name='GOLD',desc='é€Ÿåº¦ãƒ»æ­£ç¢ºã•ãƒãƒƒãƒãƒªï¼';if(t==='silver'){color='conic-gradient(from 0deg, var(--silver), #e3e7ef, var(--silver))';name='SILVER';desc='å®‰å®šã‚¯ãƒªã‚¢ï¼'}if(t==='bronze'){color='conic-gradient(from 0deg, var(--bronze), #dfb398, var(--bronze))';name='BRONZE';desc='ã¾ãšã¯ã‚¯ãƒªã‚¢ï¼æ¬¡ã¯ã‚¹ãƒ”ãƒ¼ãƒ‰ã‚¢ãƒƒãƒ—ã‚’ç‹™ãŠã†'}medal.style.background=color;tierTitle.textContent=name+' MEDAL';tierDesc.textContent=desc}
function closeReward(){reward.style.display='none'}

const topEl=document.getElementById('top'),lessonEl=document.getElementById('lesson'),daysEl=document.getElementById('days')
const day_title=document.getElementById('day_title'),day_idx=document.getElementById('day_idx')
const s1=document.getElementById('s1'),s2=document.getElementById('s2'),s3=document.getElementById('s3')
const day_svg=document.getElementById('day_svg'),explain=document.getElementById('explain')
const d_k=document.getElementById('d_k'),d_a=document.getElementById('d_a'),c_k=document.getElementById('c_k'),c_a=document.getElementById('c_a'),msg=document.getElementById('msg'),next_btn=document.getElementById('next_btn')
const nav_days=document.getElementById('nav_days'),days_list=document.getElementById('days_list')
function buildDays(){const list=days_list;list.innerHTML='';DAYS.forEach((d,i)=>{const b=document.createElement('button');b.className='btn';b.textContent=(i+1)+'. '+d.title;b.addEventListener('click',()=>openLesson(i));list.appendChild(b)})}
(function init(){updateBar();buildDays();nav_days.innerHTML='';DAYS.forEach((d,i)=>{const b=document.createElement('button');b.className='btn';b.textContent='Day'+(i+1);b.addEventListener('click',()=>openLesson(i));nav_days.appendChild(b)})})();
</script>
</body>
</html>
